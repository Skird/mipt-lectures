\documentclass{article}

\input{common}

\begin{document}

\section*{Лекция 3. Уравнение Пелля}
\addcontentsline{toc}{section}{Лекция 3. Уравнение Пелля}
\resetcntrs

\section{Задачи, сводимые к~уравнению Пелля}

\begin{problem}
  Имеется урна, внутри которой~$n$ чёрных шаров и~$m$ белых. Какими должны
  быть~$n$ и~$m$, чтобы вероятность наугад вытянуть два белых шара была
  равна~$\frac{1}{2}$?
\end{problem}

Вероятность нужного события, очевидно, равна~$\frac{C_m^2}{C_{m + n}^2} =
\frac{m(m - 1)}{(m + n)(m + n - 1)}$. То есть нужно решить следующее диофантово
уравнение:
\begin{gather*}
  2m(m - 1) = (m + n)(m + n - 1),\\
  2m^2 - 2m = m^2 + 2mn + n^2 - n - m,\\
  m^2 - 2mn - n^2 - m + n = 0,\\
  (m - n)^2 - 2n^2 - (m - n) = 0,\\
  4(m - n)^2 - 8n^2 - 4(m - n) + 1 = 1
  (2(m - n) - 1)^2 - 2(2n)^2 = 1.
\end{gather*}
Обозначая~$2(m - n) - 1 = x, 2n = y$, получаем уравнение, названное в~честь
Джона Пелля\footnote{Леонард Эйлер ошибочно приписывал авторство общей
постановки этой задачи Пеллю, который, однако, не имел к~уравнению никакого
отношения. Несмотря на то, что оно упоминается в~трудах древнегреческих
и~древнеиндийских математиков, а~также в~современной постановке в~трудах Пьера
Ферма, название уравнения прочно закрепилось в~литературе.}:
$$ x^2 - 2y^2 = 1.$$

В~общем случае уравнением Пелля называется уравнение вида~$x^2 - my^2 = 1$, где
число~$m$ не является полным квадратом.

\begin{problem}
  Найти все прямоугольные треугольники с~целыми сторонам, у~которых катеты
  отличаются ровно на~$1$.
\end{problem}

\begin{exercise}
  Свести задачу о~прямоугольных треугольниках к~уравнению Пелля.
\end{exercise}

% Записано почти дословно
Ещё удивительный один факт, мотивирующий задачу, состоит в~том, что при решении
уравнения Пелля анализируются так называемые <<гиперболические повороты>>,
которые играют важную роль в~теории относительности Эйнштейна.

\section{Уравнения Пелля для $m = 2$}

\subsection{Отображения~$\psi$ и~$\overline\psi$}

Решения двух похожих уравнений
\begin{gather}
  \label{pell} x^2 - 2y^2 = 1,\\
  \label{antipell} x^2 - 2y^2 = -1
\end{gather}
в~вещественных числах представляют собой две гиперболы на плоскости. Очевидно,
что общие амсимптоты, задаваемые уравнением~$x^2 - 2y^2 = 0$, не содержат целых
точек и~имеют угловой коэффициент $\sqrt{2}$. Это придает решению уравнения
Пелля ещё один смысл, заключающийся в~поиске рациоанальных приближений
числа~$\sqrt{2}$ (так как с~ростом~$x$ и~$y$, если конечно решений бесконечно
много, отношение $\frac{y}{x}$ всё ближе приближается к~$\sqrt{2}$).

Несмотря на то, что для решения уравнений можно ограничиться рассмотрением
первого квадранта, удобнее искать решения с~$x + \sqrt{2} y > 0$.
Несколько решений сразу угадываются, например, $(1, 1)$ для уравнения с~$-1$
в~правой части, и~$(1, 0)$ для другого.

Пусть задано оторбражние $\psi \colon \mathbb{R}^2 \rightarrow \mathbb{R},
\psi(x, y) = x + y \sqrt{2}$, представляющее собой проекцию вдоль направления,
задаваемого вектором $(\sqrt{2}, -1)$, на ось ординат. Легко видеть, что
$\psi^2(1, 1) = (1 + \sqrt{2})^2 = 3 + 2\sqrt{2}$, а~также, что пара $(3, 2)$
является решением уравнения Пелля. Двойственное
отображение~$\overline{\psi}(x, y) = x - y \sqrt{2}$ тоже обладает полезными
свойствами.

\begin{claim}
  Если $\psi^k(1, 1) = m + n \sqrt{2}$ (очевидно, что $m, n > 0$), то
  $\overline{\psi}^k(1, 1) = m - n \sqrt{2}$.
\end{claim}
\begin{proof}
  Рассмотрев бином Ньютона для~$(1 + \sqrt{2})^k$ и~$(1 - \sqrt{2})^k$, легко
  заметить, что они отличаются только знаком каждого из слагаемых, в~которых
  $\sqrt{2}$ присутствует в~нечётной степени, из чего утверждение немедленно
  следует.
\end{proof}

Из утверждения следует, что $(\psi \cdot \overline{\psi})^k(1, 1) = m^2 - 2n^2$
для некоторых $n, m \in \mathbb{N}$. Вместе с~тем,
$(\psi \cdot \overline{\psi})^k = (1 + \sqrt{2})^k (1 - \sqrt{2})^k = (-1)^k$.
Итак, для чётных~$k$ результат действия~$\psi^k$ на~$(1, 1)$ будет являться
решением~(\ref{pell}), для нечётных~--- решением (\ref{antipell}).

Более того, предыдущие рассуждения можно провести не только для точки~$(1, 1)$,
но и~для произвольного решения (\ref{antipell}), получив тем самым бесконечную
цепочку решений для обоих уравнений в~чередующемся порядке.

\begin{exercise}
  Доказать, что если взять за начальную точку решение уравнения~(\ref{pell}),
  то получится бесконечная цепочка только из решений~(\ref{pell}).
\end{exercise}

\subsection{Структура множества решений при $m = 2$}

Естественным образом возникает вопрос: верно ли, что все решения~(\ref{pell})
и~(\ref{antipell}) могут быть порождены каким-то одним решением?

\begin{theorem}
  Все решения уравнений~(\ref{pell}) и~(\ref{antipell}), лежащие
  в~полуплоскости~$x > 0$, могут быть получены указанным способом из
  решения~$(1, 1)$ при некотром $k \in \mathbb{Z}$.
\end{theorem}
\begin{proof}
  Пусть существует некоторое решение~$(A, B)$ одного из уравнений, которое не
  может быть представлено в~виде~$(1 + \sqrt{2})^k$. Без потери общности,
  $A, B > 0$. Тогда~$\frac{\psi(A, B)}{1 + \sqrt{2}} = -(A + B \sqrt{2})(1 -
  \sqrt{2}) = (2B - A) + (A - B) \sqrt{2}$. Это снова решение одного из
  уравнений~(\ref{pell}) или~(\ref{antipell}), что легко проверить напрямую
  или так, как это было проделано раньше. Более, того, можно заметить, что
  проделать это можно не только с~$(A, B)$ и~$(1, 1)$, но и~с~любой парой
  решений.
  \begin{exercise}
    Если $(A, B), (C, D)$~--- два решения указанных уравнений, то $(AC + 2BD,
    AD + BC)$ тоже является решением.
  \end{exercise}

  Эта операция обратима, а~значит является групповой и~вводит на
  точках двух частей гипербол, лежащих в~полуплоскости $x + y\sqrt{2} > 0$,
  структуру группы Ли, что означает её непрерывность по всем аргументам. Более
  того, точки гиперболы, соотвествующей~(\ref{pell}), образуют подгруппу
  описанной группы индекса~2, которая также является группой Ли.

  Таким образом, полученное решение $(2B - A) + (A - B)\sqrt{2}$ тоже не может
  быть представлено в~виде~$(1 + \sqrt{2})^k$, так как иначе исходное решение
  обязательно будет представимо. Для завершения доказательства необходимо ввести
  норму на решениях уравнения, чтобы показать, что бесконечный спуск по этому
  правилу невозможен. Норму задаёт не что иное, как функция $\psi(A, B)$.

  Норма $\psi(A, B)$ лежит между нормами каких-то двух последовательных
  решений, имеющих вид~$(1 + \sqrt{2})^k$ и~$(1 + \sqrt{2})^{k+1}$. Если
  делить~$(A, B)$ $k$~раз на $1 + \sqrt{2}$ по описанному правилу, то получится
  решение $(X, Y), Y > 0$, не представимое в~виде степени $(1 + \sqrt{2})$,
  лежащее по норме между решениями~$(1, 1)$ и~$(1, 0)$, что невозможно.

  В~терминах теории групп, сказанное выше можно пересказать так: группа Ли,
  соответствующая уравнению~(\ref{pell}) содержит дискретную подгруппу,
  содержащую все целочисленные его решения. Эта подгруппа
  изоморфна~$\mathbb{Z}$.
\end{proof}

\section{Уравнение Пелля в~общем случае}

\subsection{Распространение групповой операции на кольцо~$\mathbb{Z}^2$}

Неожиданно сложной задачей в~общем случае оказывается отыскание хотя бы одного
решения. В~частности, при~$m = 61$, $x$-координата наименьшего решения
больше~$10^9$. Если же хотя бы одно решение найдено, то дальнейший анализ
строится на тех же идеях, что и~в~случае~$m = 2$.

\begin{theorem}
  При любом~$m$, для которого существует хотя бы одно решение, решения образуют
  группу c операцией~$\ast\colon \mathbb{R}^2 \times \mathbb{R}^2
  \rightarrow \mathbb{R}^2$, $(a, b) \ast (c, d) = (ac + m\cdot bd, ac + bd)$,
  причем эта группа изоморфна~$\mathbb{Z}$.
\end{theorem}

Пусть $\Gamma_{\eta}$~--- гипербола~$x^2 - my^2 = \eta$.
$\bigcup\limits_{\eta \in \mathbb{Z}} \Gamma_\eta$ покрывает все целые точки
плоскости, так как~$\mathbb{Z}^2 \ni (x, y) \in \Gamma_{x^2 - my^2}$.

\begin{exercise}
  Пусть $L_{a,b}\colon\mathbb{R}^2\rightarrow\mathbb{R}^2,
  L_{a,b}(c, d) = (a, b) \ast(c, d)$. Тогда~$L$ линейно и~обратимо тогда
  и~только тогда, когда $a^2 - mb^2 \ne 0$.
\end{exercise}

Из упражнения следует, что~$(\mathbb{R}^2, +, \ast)$ является алгеброй,
а~её обратимые элементы лежат в~объединении прямых~$x + \sqrt{m}y = 0$
и~$x - \sqrt{m}y = 0$.

Пусть снова~$\psi\colon \mathbb{R}^2 \rightarrow \mathbb{R},
\psi(a, b) = a + b\sqrt{m}$.

\begin{claim}
  $\psi$ является гомоморфизмом алгебр $(\mathbb{R}^2, +, \ast)$
  и~$(\mathbb{R}, +, \cdot)$.
\end{claim}
\begin{proof}
  Чтобы показать, что~$\psi$~--- гомоморфизм необходимо и~достаточно проверить,
  что оно сохраняет сложение и~умножение. Линейность~$\psi$ очевидна:
  $\psi(a + b) = \psi(a) + \psi(b)$. Проверка второго условия также несложна:
  \begin{multline*}
    \psi( (a, b) \ast (c, d) ) = \psi(ac + mbd, ad + bc) = \\
    (ac + mbd) + (ad + bc)\sqrt{m} = (a + b\sqrt{m})(c + d\sqrt{m})
    = \psi(a, b)\psi(c, d).
  \end{multline*}
\end{proof}
\begin{exercise}
  Показать, что $\overline\psi(a, b) = a - b\sqrt{m}$ также явялется
  гомоморфизмом.
\end{exercise}

\begin{definition}
  Пусть \emph{норма} $N(a, b)$ точки~$(a, b)$ задана
  формулой~$N(a, b) = \psi(a, b)\overline\psi(a, b) = a^2 - mb^2$.
  Легко видеть, что для целых $a, b$ норма целая и~обладает свойством
  мультипликативности.
\end{definition}

\begin{conclusion}
  Если~$\xi = N(a, b), \eta = N(c, d)$, то $(a, b) \in \Gamma_\xi$,
  $(c, d) \in \Gamma_\eta$, $(a, b) \ast (c, d) \in \Gamma_{\xi \eta}$.
\end{conclusion}

\subsection{Групповая структура решений в~общем случае}

Если существует хотя бы одно целое решение уравнения Пелля~$(x, y) \in
\Gamma_1$, то все его целые степени относительно операции $\ast$ образуют
дискретную изоморфную $\mathbb{Z}$ подруппу в~описанной алгебре. Все элементы
этой подгруппы, естественно, также будут целочисленными решениями уравнения
Пелля. Чтобы доказать, что никаких других решений нет, необходимо развить
технику, использованную в~случае~$m = 2$.

Пусть для определённости~$(x, y)$ таково, что $x, y > 0$ и~$\nexists (x_1, y_1)
\in \mathbb{Z}^2 \cap \Gamma_1 \colon x_1 < x$. Пусть существует какое-нибудь
решение~$(x',y') \in \mathbb{Z}^2 \cap \Gamma_1, x', y' > 0$, не являющееся
степенью~$(x, y)$. $(x, -y)$ тоже является целым решением уравнения
Пелля, притом~$\psi(x, -y) < 1$, так как~$\psi((x, y) \ast (x, -y)) =
\psi(x, y) \psi(x, -y) = 1, \psi(x, y) > 1$.

Тогда~$\psi((x', y') \ast (x, -y)) < \psi(x', y')$, притом~$(x', y') \ast
(x, -y)$ явялется целым решением уравнения Пелля. Если~$\psi(x, y)^k <
\psi(x', y') < \psi(x, y)^{k+1}$ (такое $k$ существует, так как $(x', y')$ не
является степенью $(x, y)$), то если $p = (x', y') \ast (x, -y)^{k}$, то~$p$
снова будет решением уравнения Пелля, при этом~$1 = \psi(1, 0) < \psi(p) <
\psi(x, y)$. Но это противоречит предположению о~том, что решение~$(x, y)$
обладает наименьшим~$x$ (так как при движении по гиперболе в~верхней
полуплоскости~$x$ и~$y$ монотонно возрастают, то~$(x, y)$ будет решением
с~наименьшим $\psi(x, y)$, при условии, что $\psi(x, y) > 1$).

\begin{exercise}
  Показать, что если существует хотя бы одно целое решение
  уравнения~$x^2 - my^2 = -1$, то порождённая им группа включает в~себя все
  решения этого уравнения и~уравнения Пелля и~изоморфна $\mathbb{Z} \oplus
  \mathbb{Z}_2$.
\end{exercise}

\section{Существование решения уравнения Пелля}

\subsection{Методы геометри чисел}

\begin{exercise}
  Доказать, что отображние $\psi$, ограниченное на $\mathbb{Q}^2$,
  вкладывается в~$\mathbb{R}$ (взаимно-однозначно),
  а~множество~$\psi(\mathbb{Q}^2) = \{a + b\sqrt{m} \mid a, b \in
  \mathbb{Q}\}$ является двумерным линейным пространством над~$\mathbb{Q}$
  и~более того, полем.
\end{exercise}

Итак, $(\mathbb{Z}^2, \ast, +)$ является алгеброй (а~значит и~кольцом),
изоморфной кольцу~$\{a + b\sqrt{m} \mid a, b \in \mathbb{Z}\} \subset
\mathbb{R}$. Уравнения Пелля в~такой интерпретации ставит вопрос
о~поиске обратимых элементов (мультипликативной группы) этого кольца, так как
для поиска обратного к~элементу~$(a, b)$ нужно
\begin{gather*}
  (a + b\sqrt{m})(c + d\sqrt{m}) = 1,\\
  (a - b\sqrt{m})(c + d\sqrt{m}) = 1,\\
  (a^2 - mb^2)(c^2 - md^2) = 1.
\end{gather*}
В~последнем равенстве все числа целые, откуда~$a^2 - mb^2 = \pm 1$
и~$c^2 - md^2 = \pm 1$. С~другой стороны, если~$a^2 - mb^2 = \pm 1$, то
$(a + b\sqrt{m})(a - b\sqrt{m}) = \pm 1$ и~оба числа обратимы. Итак, решение
уравнения Пелля~--- это в~сущности исследование обратимых элементов описанного
кольца. Так как структура этого кольца уже выяснена ранее, остается только
доказать существование хотя бы одного его элемента, для чего используются методы
геометрии чисел.

\begin{lemma}
  Пусть задана (измеримая и~ограниченная) фигура $\Phi \subset \mathbb{R}^2$
  с~площадью $S(\Phi)>1$. Тогда~$\exists x, y \in \Phi\colon (x - y)$~---
  целочисленный вектор.
\end{lemma}
\begin{proof}
  Поскольку фигура ограничена, то~$\exists r \in \mathbb{N}\colon \forall p \in
  \Phi \rightarrow \max\{p_x, p_y\} < r$. Иными словами, фигура~$\Phi$
  вписывается в~достаточно большой целочисленный квадрат.

  Пусть теперь~$\Phi_1, \ldots, \Phi_k$~--- части фигуры, попавшие
  в~полуоткрытые ячейки целочисленной решётки ($Q_{a,b} = \{ x, y \mid a \le x
  < a + 1, b \le y < b + 1\}$). Пусть также~$\Psi_i = \left\{ (\{x\}, \{y\})
  \mid (x, y) \in \Phi_i \right\}$, где~$\{x\}$ обозначает дробную часть $x$.
  Иными словами, $\Psi_i$ есть параллельный перенос фигуры~$\Phi_i$ на
  целочисленный вектор в~единичный квадрат $0 \le x < 1, 0 \le y < 1$.

  По свойству площадей (во всех операциях выше рассматриваемые объекты остаются
  измеримыми)~$\sum_i S(\Psi_i) = \sum_i S(\Phi_i) = S(\Phi) > 1$. Если никакие
  две фигуры~$\Psi_i, \Psi_j$ не пересекаются, то~$S(\bigcup_i \Psi_i) =
  \sum_i S(\Psi_i) > 1$. С~другой стороны, $\bigcup_i \Psi_i \in [0; 1) \times
  [0; 1)$, откуда~$S(\bigcup_i \Psi_i) \le 1$, противоречие.

  Тогда существует точка~$p \in [0; 1) \times [0; 1)$, принадлежащая
  одновременно двум фигурам~$\Psi_i, \Psi_j$. Однако, из того, что $p \in
  \Psi_i$ следует, что~$p$ отличается от какой-то точки~$\Phi$ на целочисленный
  вектор. Аналогично, $p$ отличается от какой-то другой (отличной от предыдущей
  по построению) точки~$\Phi$ на целочисленный вектор. Из этого немедленно
  следует, что в~$\Phi$ есть две точки, отстоящие на целочисленный вектор.
\end{proof}
\begin{remark}
  Доказательство леммы легко обобщается на многомерный случай.
\end{remark}

\begin{lemma}[Минковского о~выпуклом теле]
  Пусть~$\Phi \subset \mathbb{R}^2$ ценрально-симметричная, выпуклая, измеримая
  фигура с~площадью~$S(\Phi) > 4$. Тогда $\exists p \in \Phi \cap (\mathbb{Z}^2
  \setminus (0, 0))$.
\end{lemma}
\begin{proof}
  Пусть $\Psi = \{ (\frac{x}{2}, \frac{y}{2}) \mid (x, y) \in \Phi \}$.
  Очевидно, что $\Psi$ измерима и~имеет площадь больше~1. Тогда по предыдущей
  лемме в~$\Psi$ существуют две точки $p \ne q$, отстоящие на целочисленный
  вектор~$v$. Остаётся доказать, что $v \in \Phi$. Это верно, так как~$(-p) \in
  \Psi \Rightarrow \frac{(-p) + q}{2} \in \Psi$ (из-за выпуклости). Тогда~$q -
  p = v \in \Phi$ по определению фигуры~$\Psi$. Итого, ненулевая точка с~целыми
  координатами вектора~$v$ лежит в~фигуре $\Phi$.
\end{proof}

\subsection{Существование решений уравнения Пелля}

Лемма Минковского оказывается невероятно полезной для отыскания целой точки
на гиперболах $\Gamma_n$. Пусть $p_{\pm n}, q_{\pm n}$~--- это точки пересечения
гипербол~$\Gamma_{\pm n}$ с~координатными осями.

\begin{exercise}
  Найти наименьшее~$n$, такое что площадь ромба, построенного на точках
  $p_{\pm n}, q_{\pm n}$ больше~4.
\end{exercise}

\begin{exercise}
  \label{parallelogram}
  Пусть~$A \in \Gamma_n$, параллелограмм~$ABCD$ имеет все точки на гиперболах
  $\Gamma_{\pm n}$, причем стороны его параллельны асимптотам~$y = \pm \sqrt{m}
  x$. Доказать, что его площадь не зависит от выбора точки~$A$ и~найти её.
\end{exercise}

Пусть теперь фигура~$X = \bigcup\limits_{|x| < n, x \in \mathbb{R}} \Gamma_x$.
Ключевое наблюдение заключается в~том, что~$X$ содержит бесконечно много целых
точек. В~самом деле, если их конечное число, то пусть точка~$p$ лежит в~первом
квадранте и~является самой близкой к~асимптоте~$y = \sqrt{m}x$. Важно, что точка
$p$ не может лежать на асимптоте, так как наличие целой точки на асимптоте
значило бы, что~$m$ является полным квадратом. Тогда можно выбрать на
гиперболе~$\Gamma_n$ точку~$A$, такую что расстояние от~$A$ до асимптоты меньше,
чем расстояние от~$p$ до неё же. Тогда параллелограмм из
упражнения~\ref{parallelogram} содержит целую точку, которая принадлежит~$X$ и
находится ближе к~асимптоте, чем точка~$p$, что противоречит предположению.

Итак, фигура~$X$ содержит бесконечное число целых точек. Однако, все её целые
точки покрываются конечным числом гипербол $\Gamma_{-n}, \ldots, \Gamma_n$.
Это значит, что на какой-то гиперболе~$\Gamma_l$ находится бесконечно много
целых точек.

\begin{claim}
  На гиперболе~$\Gamma_l$ существуют точки $(a, b)$ и~$(c, d)$, такие что~$a
  \equiv c\pmod l, b \equiv d\pmod l$.
\end{claim}
\begin{proof}
  Поскольку на~$\Gamma_l$ бесконечно много целых точек, то пусть $p_1, \ldots,
  p_{l^2 + 1}$~--- проивзольные $l^2 + 1$ из них. Тогда по принципу Дирихле
  в~один из~$l^2$ классов сравнимости по модулю~$l$ (обеих координат) попадёт
  хотя бы две точки.
\end{proof}

\begin{claim}
  $(c, d) \mid (a, b)$ в~кольце~$(\mathbb{Z}^2, \ast)$.
\end{claim}
\begin{proof}
  Так как кольцо изоморфно~$\mathbb{Z}[\sqrt{m}]$, то можно проверить делимость
  в~нём.
  $$ \frac{a + b\sqrt{m}}{c + d\sqrt{m}} = \frac{(a + b\sqrt{m})(c - d\sqrt{m})}
  {l} = \frac{(ac - mbd) + \sqrt{m}(bc - ad)}{l}.$$
  Так как~$a \equiv c\pmod l, b \equiv d\pmod l$, то $ac - mbd \equiv a^2 - mb^2
  = l \equiv 0\pmod l$. Аналогично~$bc - ad \equiv ab - ab \equiv 0\pmod l$.
  Значит $a + b\sqrt{m}$ делится нацело на $c + d\sqrt{m}$.
\end{proof}

Аналогично, $(a, b) \mid (c, d)$, что означает, что на самом деле эти числа
ассоциированы в~кольце $(\mathbb{Z}^2, \ast)$, то есть отличаются домножением
на обратимый элемент. Так как решения уравнения Пелля и~составляют обратимые
элементы этого кольца, то частное~$(a, b)$ и~$(c, d)$ (в~любом порядке) будет
решением уравнения Пелля.

\section{Уравнение Пелля и~цепные дроби}

\subsection{Пример нахождения решений уравнения Пелля через цепные дроби}
\[
\sqrt{15} =
3 + (\sqrt{15} - 3) =
3 + \cfrac{1}{\cfrac{\sqrt{15}-3}{6}} =
3 + \cfrac{1}{1 + \cfrac{1}{\cfrac{6}{\sqrt{15}-3}}} =
3 + \cfrac{1}{1 + \cfrac{1}{3 + \sqrt{15}}}.
\]

Таким образом,
\[
  \sqrt{15} =
  3 + \cfrac{1}{1 + \cfrac{1}{6 + \cfrac{1}{1 + \cfrac{1}
  {6 + \cfrac{1}{\ddots}}}}}
\]

Можно заметить, что дроби
\[
  3 + \cfrac{1}{1} = \cfrac{4}{1},
  3 + \cfrac{1}{1 + \cfrac{1}{6 + \cfrac{1}{1}}} = \cfrac{31}{8}
\]
соответствуют решениям~$(4, 1), (31, 8)$ уравнения Пелля~$x^2 - 15y^2 = 1$.
На самом деле этот факт не является простым совпадением. Разумная гипотеза,
возникающая при анализе вышеописанных преобразований, состоит в~том, что для
любого целого числа~$m$, не являющегося полным квадратом выполнено
\[
\sqrt{m} = a_0 + \cfrac{1}{\ddots + \cfrac{1}{a_n +
\cfrac{1}{2a_0 + \cfrac{1}{\ddots + \cfrac{1}{a_n +
\cfrac{1}{2a_0 + \cfrac{1}{\ddots}}}}}}}
\]
Гипотеза подкрепляется следующей важной теоремой.

\begin{theorem}[Лагранжа]
  Пусть~$\alpha \in \mathbb{R} \setminus \mathbb{Q}$. Тогда~$\alpha$ обладает
  конечно-периодической цепной дробью тогда и~толко тогда, когда~$\alpha$
  удовлетворяет уравнению~$ax^2 + bx + c = 0$ для некоторых целых~$a, b, c$.
\end{theorem}

\subsection{Основные свойства цепных дробей}

Для более тонкого понимания связи этих явлений нужно вспомнить основные свойства
цепных дробей. В~самом общем случае цепная дробь\footnote{Для более подробного
и~исчерпывающего описания можно обратиться к~книге А. Я. Хинчина <<Цепные
дроби>>} $$[a_0; a_1, \ldots a_n] = a_0 + \cfrac{1}{\ddots + \cfrac{1}{a_n}}$$
рассматривается в~поле рациональных дробей~$\mathbb{Z}(a_0,\ldots,a_n)$
с~$n + 1$ независимой переменной~$a_0, \ldots, a_n$, которые следует
воспринимать просто как формальные символы. Если сворачивать цепную дробь
от конца к~началу, то полученное выражение будет иметь вид $\frac{P_n}{Q_n}$,
где~$P_n,Q_n \in \mathbb{Z}[a_0,\ldots,a_n]$.

Правило вычисления $P_n$ и~$Q_n$ также выполнено в~самом общем случае и~выглядит
следующим образом:
$$
\begin{cases}
  P_n = a_n P_{n-1} + P_{n-2},\\
  Q_n = a_n Q_{n-1} + Q_{n-2}.
\end{cases}
$$

Основное свойство числителей и~знаменателей цепных дробей~$P_n Q_{n-1} - P_{n-1}
Q_n = (-1)^n$ также выполнено в~общем случае.

Более того, полезно заметить, что при вычислении цепных дробей не используется
вычитание, то есть в~некотором смысле вместо кольца~$\mathbb{Z}$ можно поставить
не являющееся кольцом множество целых положительных чисел $\mathbb{Z}_+$
с~операциями сложения и~умножения.

Если же рассмотреть более специальный случай, когда~$a_0, \ldots, a_n \in
\mathbb{R}_+$, то значение цепной дроби также будет лежать в~$\mathbb{R}_+$.
Поскольку наибольший интерес представляет исследование свойств бесконечных
цепных дробей, то естественным образом возникает вопрос, когда ряд из значений
подходящих цепных дробей сходится к~какому-то числу.

\begin{theorem}
  Пусть числа~$a_0, \ldots, a_n, \ldots \in \mathbb{R}_+$. Тогда бесконечная
  цепная дробь~$[a_0; a_1, \ldots, a_n, \ldots]$ определена (сходится
  последовательность $\frac{P_n}{Q_n}$) тогда и~только тогда, когда
  ряд~$\sum a_i$ расходится.
\end{theorem}
\begin{exercise}[сложное]
  Доказать теорему.
\end{exercise}

Однако, даже если ряд сходится, можно показать, что подходящие дроби с~чётными
номерами возрастают, а~с~нечётными убывают и~всегда будут меньше, чем дроби на
чётных местах. Если сумма $\sum a_i$ расходится, то между пределом
последовательности чётных приближений и~пределом последовательности нечётных
будет какое-то расстояние, в~противном случае последовательности стремятся
к~одному и~тому же числу.

Из теоремы также вытекает то, что любая цепная дробь с~целыми положительными
коэффициентами заведомо сходится к~какому-то вещественному числу.

\subsection{Геометрическая интерпретация цепных дробей}

Полезным инстрементом для работы с~цепными дробями является их визуальное
представление на координатной плоскости. Если положить $P_{-2} = 0, Q_{-2} = 1,
P_{-1} = 1, Q_{-1} = 0$\footnote{можно убедиться, что никакие из правил для
подходящих дробей от этого не нарушаются} и~изображать дробь~$\frac{x}{y}$ как
точку $(x, y)$ плоскости (значением дроби в~этом случае будет наклон прямой,
проходящей через начало координат и~её точку), то процесс нахождения подходящей
дроби $\frac{P_n}{Q_n}$ числа~$\alpha$ из двух предыдущих может быть описан как
последовательное прибавление вектора~$(P_{n-1},Q_{n-1})$ к~начальному
вектору~$(P_{n-2},Q_{n-2})$ до тех пор, пока получающаяся точка не перейдет по
другую сторону прямой~$y = \alpha x$. Последняя точка перед переходом и~будет
соотвествовать подходящей дроби.

Операции сложения векторов в~вещественных числах соотвествует операции взятия
медианты двух дробей: $\frac{a}{b} \ast \frac{c}{d} = \frac{a + b}{c + d}$. Все
дроби, получаемые в~процессе построения (последовательного взятия медианты)
носят название \emph{промежуточных} и~исследуются наравне с~подходящими.

\begin{exercise}
  Доказать, что описанный процесс построения строит такую же цепную дробь, что
  и~стандартный процесс построения, использующий операцию взятия целой части.
\end{exercise}

Основное свойство подходящих дробей на плоскости соответсвует тому факту, что
параллелограмм, построенный на соседних подходящих дробях имеет единичную
площадь. Это следует из того, что площадь такого параллелограмма может быть
записана как определитель $\begin{Vmatrix} P_n & Q_n \\ P_{n-1} & Q_{n - 1}
\end{Vmatrix} = 1$. Таким образом число~$\alpha$ помещается в~цепочку все более
узких параллелограммов единичной площади, что связано с~исследованием группы
невырожденных преобразований плоскости, сохраняющих площадь~$SL(2, \mathbb{Z})$.
% Тут Савватеев немного неправ, с~обозначением, то, что он имеет в~виду
% обозначается SL (specialized linear)
Эта же группа отвечает за вид разных целочисленных квадратичных
форм\footnote{Об этом подробно написано в~книге Джона Хортона Конвея
<<Квадратичные формы, данные нам в~ощущениях>> (John Horton Conway - The Sensual
(Quadratic) Form).}.

\subsection{Наилучшие приближения}

Один из главных смыслов представления числа в~виде цепной дроби~--- это
получение его хороших рациональных приближений.

\begin{definition}
  Число~$\frac{p}{q} \in \mathbb{Q}$ является наилучшим приближением
  \emph{первого рода} числа $\alpha \in \mathbb{R}$ , если $\forall~\mathbb{Q}
  \ni \frac{a}{b} \ne \frac{p}{q}, |b| \le |q| \rightarrow \left| \alpha -
  \frac{p}{q} \right| < \left| \alpha - \frac{a}{b} \right|$.
\end{definition}

\begin{definition}
  Число~$\frac{p}{q} \in \mathbb{Q}$ является наилучшим приближением
  \emph{второго рода} числа $\alpha \in \mathbb{R}$ , если $\forall~\mathbb{Q}
  \ni \frac{a}{b} \ne \frac{p}{q}, |b| \le |q| \rightarrow \left| q\alpha - p
  \right| < \left| b\alpha - a \right|$.
\end{definition}

\begin{theorem}
  Любое приближение первого рода является промежуточной дробью, если в~качестве
  промежуточных рассматривать в~том числе и~дроби, полученные~при $p = 1, q =
  0$.
\end{theorem}
\begin{exercise}
  Доказать теорему и~убедиться, что обратное утверждение верно не всегда.
\end{exercise}

\begin{theorem}
  Любое приближение втогоро рода является подходящей дробью. Если ещё~$\alpha -
  \frac{1}{2}$ не является целым числом, то любая подходящая дробь является
  наилучшим приближением второго рода.
\end{theorem}

\begin{exercise}
  Доказать теорему.
\end{exercise}

\subsection{Формулы для решений уравнения Пелля}

\begin{exercise}
  Для подходящей дроби~$\frac{p_n}{q_n}$ выполнено
  $$ \frac{1}{q_n (q_n + q_{n+1})} < \left| \alpha - \frac{p_n}{q_n} \right| <
  \frac{1}{q_n q_{n+1}}. $$
\end{exercise}

\begin{exercise}
  Если для каких-то~$p, q \in \mathbb{N}$ выполнено $\left| \alpha - \frac{p}{q}
  \right| < \frac{1}{2q^2}$, то~$\frac{p}{q}$ является подходящей дробью.
\end{exercise}

Остаётся только заметить, что любое решение уравнения Пелля удовлетворяет
условию предыдущего упражнения, а~значит искать решения следует исключительно
среди подходящих дробей числа~$\sqrt{m}$.

\begin{exercise}
  Для любого~$m \in \mathbb{N}$, не явяляющегося полным квадратом его цепная
  дробь имеет вид~$\sqrt{m} = [a_0; a_1, \ldots a_n, 2a_0, a_1, \ldots, a_n,
  2a_0, \ldots]$, а~решения уравнения Пелля имеют вид
  \begin{gather*}
    \frac{x_1}{y_1} =
    [a_0; a_1 \ldots a_n],\\
    \frac{x_2}{y_2} =
    [a_0; a_1 \ldots a_n, 2a_0, a_1, \ldots, a_n],\\
    \frac{x_3}{y_3} =
    [a_0; a_1, \ldots, a_n, 2a_0, a_1, \ldots, a_n, 2a_0, a_1, \ldots, a_n],\\
    \vdots
  \end{gather*}
\end{exercise}

\end{document}
