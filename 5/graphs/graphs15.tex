\documentclass{article}
\input{common}

\begin{document}

\section{Длинные пути в~случайном графе}

Пусть граф уже связен: $p = \frac{(1 + \eps) \ln n}{n}$. Можем ли мы в~нём набрать достаточно
длинный путь?

\begin{theorem}
	Пусть $p = \frac{\theta}{n}, 0 < \theta = \theta(n) < \ln n - 3 \ln \ln n$. Тогда с~вероятностью,
	стремящейся к~1, $G(n, p)$ содержит путь длины $(1 - \frac{4\ln2}{\theta}) n$.
\end{theorem}
\begin{proof}
	Рассмотрим случайный мультиграф~$G(n, r, r)$, в~котором между любыми двумя
	проводится независимо два случайных ребра: красное и~синее, оба с~вероятностью $r$. Если цветные
	рёбра обесцветить, то $G(n, r, r)$ превращается в~$G(n, p_0)$, где $p_0 = 1 - (1 - r)^2$, то есть
	при $r = \frac{r}{2}$, то $p_0 = p - \frac{p^4}{4} < p$. Таким образом, если в~$G(n, r, r)$ есть
	достаточно длинный путь, то и~в~$G(n, p)$ он тоже есть в~силу монотонности свойства.

	Идея заключается в~анализе поиска в~глубину, а~именно следующей его имитации:
	\begin{itemize}
		\item Будем двигаться по красным рёбрам без возвратов, пока возможно, выбирая произвольный из
			доступных вариантов
		\item Когда переход в~новые вершины по красным рёбрам невозможен, пытаемся перейти по синим
		\item Когда переход невозможен и~по синему ребру, возвращаемся в~ближашую вершину, из которой мы
			не пытались переходить по синим ребрам
		\item Если мы вернулись в~начало пути, то выкинем из графа все, что прошли и~запустимся из
			другой вершины
	\end{itemize}

	Более формально: $G(n, r, r)$~--- цветной мультиграф и~$\forall k=0, \ldots \exists (P_k, U_k,
	B_k)$, где $P_k$~--- текущий набранный путь, $U_k$~--- множество неиспользованных вершин,
	$B_k$~--- множество <<синих>> вершин (из которых мы пытались идти по синему ребру). В~начальный
	момент времени есть $x_0 \in V(G(n, r, r)), P_0 = x_0, U_0 = V \setminus \{x_0\}, B_0 =
	\varnothing$.

	Пусть известна тройка $(P_k, U_k, B_k)$, $x_k$~--- первая вершина $P_k$, $y_k$~---
	последняя, $|U_k| = u_k$. Если $u_k = 0$, то алгоритм остановится. Иначе, есть следующие случаи:
	\begin{enumerate}
		\item $y_k \notin B_k$. Если есть красное ребро $(y_k, y_{k+1})$, где $y_{k+1} \in U_k$, то
			$y_{k+1}$ добавляется в~путь: $P_{k+1} = P_k y_{k+1}, U_{k+1} = U_k \setminus \{y_{k+1}\},
			B_{k+1} = B_k$.

			Если красных рёбер не нашлось, то $P_{k+1} = P_k, U_{k+1} = U_k, B_{k+1} = B_k \cup \{y_k\}$
		\item $y_k \in B_k$ и~$V(P_k) \setminus B_k \ne \varnothing$, то ищется синее ребро $(y_k,
			y_{k+1})$ между $y_k$ и~$U_k$. Если оно найдено, то оно добавляется: $P_{k+1} = P_k y_{k+1},
			U_{k+1} = U_k \setminus \{y_{k+1}\}, B_{k+1} = B_k$.

			Если синего ребра не нашлось, то нужно найти $y_{k+1}$~--- ближайшую к~$y_k$ вершину $P_k$ не
			из $B_k$. Укорачиваем путь до $y_{k+1}$ и~добавляем её в~$B_k$: $P_{k+1} = x_k \ldots y_{k+1},
			U_{k+1} = U_k, B_{k+1} = B_k \cup \{y_{k+1}\}$
		\item $V(P_k) \subset B_k$. Тогда с~вероятностью $(1-r)^{u_k}$ будем просто ничего не делать
			($P_{k+1} = P_k, U_{k+1} = U_k, B_{k+1} = B_k$). Если же эта вероятность не реализовалась, то
			ищем синее ребро между $y_k$ и~$U_k$.

			Если ребро не найдено, то процесс придется начать сначала: $P_{k+1} = x_{k+1}, U_{k+1} = U_k
			\setminus \{x_{k+1}\}, B_{k+1} = B_k$.
	\end{enumerate}

	\begin{remark}
		Ничегонеделание не меняет никакие множества, а~просто растягивает один шаг на, возможно,
		несколько. Таким образом получается удобное свойство: на каждом шаге алгоритма размер $U_k$
		меняется примерно одинаково.
	\end{remark}

	Пусть $l_k = |P_k| - 1$, $b_k = |B_k|$. По определнию имеем $n - u_0 + b_0 = 1$. Для каждого
	момента $k \in \mathbb{N}$ рассмотрим величины $n - u_k + b_k$ и~$n - u_{k+1} + b_{k+1}$. Ясно,
	что $1 + n - u_k + b_k \ge n - u_{k+1} + b_{k+1}$. Далее рассмотрим
	$V \setminus (U_k \cup V(P_k))$. Оно лежит в~$B_k$. Тогда $n - u_k + b_k \le k + 1$, так как оно
	увеличивается не более чем на 1 за шаг. $l_k = |P_k| - 1 \ge n - n_k - b_k - 1 \ge 2(n - u_k) - k
	- 2$. Таким образом, нам надо показать, что при правильном выборе $k$ эта разность будет
	достаточно большой.

	Пусть $H_k = \{ (P_i, U_i, B_i), i = 0, \ldots, k\}$~--- история алгоритма. На каждом шаге мы
	проверяем наличие рёбер какого-то цвета между $y_k$ и~$U_k$ и~каждый раз рассматриваются новые
	ребра (либо мы стоим на месте). Так или иначе, веротность неудачи равна $(1 - r)^{u_k}$. Таким
	образом:
	$$P(u_{k+1} = j \mid u_j = j, H_k = H) = (1 - r)^{j}.$$

	Но $u_{k+1} = u_k$ или $u_{k+1} = u_k - 1$. Время, которое мы стоим в~состоянии $j$ получается
	подчинено геометрическому распределению с~вероятностью неуспеха $(1 - r)^j$. Пусть $X_i =
	\max\{k-l+1: u_k = u_l = i\} \sim Geom(1 - (1-r)^i)$. $Y_j = \sum\limits_{j+1}^n X_i$~--- время
	достижения цепью состояния $j$. $P(u_k \le j) = P(Y_k \le k)$.

	Надо подобраться подходящие $j, k$, так чтобы $P(Y_j \le k) \rightarrow 1, 2(n - j) - k - 2 \ge
	\left(1 - \frac{4\ln 2}{\theta}\right)n$.

	Оценим ожиданию и~дисперсию $Y_j$, при $j = \left\lceil \frac{\ln2}{r} \right\rceil$:
	\begin{multline*}
		DY_j = \sum\limits_{i=j+1}^{n-1} DX_i = \sum\limits_{j+1}^{n-1} \frac{(1 - r)^i}{(1 - (1 -
		r)^i)^2} \le\\
		\le \left[ (1 - r)^{j+1} \le (1 - r)^{\frac{\ln2}{r}} \le e^{-\ln2} = \frac{1}{2} \right]
		\le 2n
	\end{multline*}
	\begin{multline*}
		EY_j = \sum\limits_{i=j+1}^{n-1} EX_i = \sum\limits_{j+1}^{n-1} \frac{1}{1 - (1 - r)^i} \le
		\sum\limits_{j+1}^{n-1} \frac{1}{1 - e^{-r_i}} \le \int\limits_{j}^{n-1} \frac{1}{1 - e^{-rx}}
		dx = \\
		=\left[ y = rx \right] = \frac{1}{r} \int\limits_{r_j}^{r(n-1)} \frac{1}{1 - e^{-y}} dy \le
		\frac{1}{r} \int\limits_{\ln2}^{rn} \sum\limits_{m=0}^{\infty} e^{-ym} dy =\\
		=\frac{1}{r} \left(rn - \ln 2 + \sum\limits_{m=1}^\infty \left( -\frac{1}{m} e^{-ym}
		\right)\mid_{\ln2}^{rn} \right) =\\
		=\frac{1}{r}\left(rn - \ln 2 + \sum\limits_{m=1}^\infty \frac{1}{m}
		2^{-m} - \sum\limits_{m=1}^\infty \frac{1}{m} e^{-rnm}\right) \le n - \frac{1}{r} e^{-rn}
	\end{multline*}

	Отсюда по неравенству Чебышева следует, что при $w(n) = \ln \ln n$ выполнено $P(Y_j \le n -
	\frac{1}{r} e^{-rn} + \sqrt{n} w(n)) \rightarrow 1$. Значит $P(u_k \le j) \rightarrow 1$, где $k =
	\left\lceil n - \frac{1}{r}e^{-rn} + \sqrt{n}w(n)\right\rceil, j = \left\lceil \frac{\ln2}{r}
	\right\rceil$. Значит. с~большой вероятностью

	\begin{multline*}
		l_k \ge 2(n - u_k) - k - 2 \ge 2(n - j) - k - 2 \ge\\
		\ge 2n - 2\left\lceil \frac{\ln2}{r} \right\rceil - n + \frac{1}{r}e^{-rn} - \sqrt(n)w(n) - 3 =\\
		= n - \frac{4\ln2}{\theta}n + \frac{1}{r} e^{-rn} - \sqrt{n}w(n) - 5
	\end{multline*}

	Поясним, поему последние слагаемые дают в~сумме $>0$. $\frac{1}{r}e^{-rn} = \frac{2n}{\theta}
	e^{-\frac{theta}{2}} \ge \frac{2n}{\ln n - 3 \ln \ln n} e^{-\frac{\ln2}{2} + \frac{3}{2}\ln\ln n}
	\ge \frac{2n}{\ln n} \frac{1}{\sqrt{n}} (\ln n)^\frac{3}{2} (1 + o(1)) = 2\sqrt{n \ln n} (1 +
	o(1)) = \omega(\sqrt{n} w(n))$.
\end{proof}

\begin{corollary}
	Рассмотрим ориентированный случайный граф с~вероятностью ребра (в~одну из двух сторон) $p =
	\frac{\theta}{n}, 0 < \theta < \ln n - 3 \ln \ln n$. Тогда с~вероятностью, стремящейся к~1, такой
	граф содержит ориентированный путь длины $\ge n\left(1 - \frac{4\ln2}{\theta}\right)$.
\end{corollary}

\end{document}
